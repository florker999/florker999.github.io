(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2445:function(e,n,r){Promise.resolve().then(r.bind(r,9343))},9343:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return E}});var t,l,i=r(9368),s=r(6041),d=r(7910),a=r(1730),c=r(3723),o=r(3008),u=r(2489),h=r(2751),j=r(1600),x=r(9015),p=r(6618),v=r(7921),m=r(5065),f=r(5296),g=r(7554),w=r(349),I=r(981),b=r(4094),z=r(756),C=r(6838),S=r(728),_=r(4881),k=r(9755),y=r(4709),D=r(1339),N=r(2990),R=r(2345),O=r(2542);(t=l||(l={}))[t.Products=0]="Products",t[t.Receipts=1]="Receipts",t[t.NewReceipt=2]="NewReceipt",t[t.Raport=3]="Raport";let P=[(0,c.p)({columnId:"name",renderHeaderCell:()=>"Nazwa",renderCell:e=>{let{name:n}=e;return n}}),(0,c.p)({columnId:"earned",renderHeaderCell:()=>"Kwota",renderCell:e=>{let{earned:n}=e;return n}})],M=[(0,c.p)({columnId:"nr",renderHeaderCell:()=>"Nr",renderCell:e=>{let{nr:n}=e;return n}}),(0,c.p)({columnId:"name",renderHeaderCell:()=>"Nazwa",renderCell:e=>{let{name:n}=e;return n}})];function E(){let e;let[n,r]=s.useState(),[t,l]=s.useState(new Map),[c,E]=s.useState(""),[J,T]=s.useState(G(new Date)),[F,H]=s.useState(),[A,L]=s.useState(!1),[U,W]=s.useState(2),[X,Y]=s.useState(),[Z,V]=s.useState(),q=s.useRef((0,O.eI)("https://tyanbughuyhtksjibpoh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR5YW5idWdodXlodGtzamlicG9oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mjc3NjI2MDUsImV4cCI6MjA0MzMzODYwNX0.F9UW4ISnsogE0AnWE2nMTI1avm_9PPfI4ij-1PiS5y4")).current,$=s.useRef(null),B=s.useRef(null),K=s.useRef(null),Q=s.useRef(null);s.useEffect(()=>{0!==U||X||(c||E("Loading products..."),q.from("product").select("nr, name").then(e=>{let{data:n}=e;n&&Y(n.map(e=>{let{nr:n,name:r}=e;return{nr:n,name:r}}))}).then(()=>E("")))},[U,X,c]),s.useEffect(()=>{let e=t.get(J);1!==U||e||(E("Loading receipt..."),q.from("receipt").select("date").eq("date",J).single().then(e=>{let{data:n}=e;n&&q.from("sold_good_product").select("*").eq("date",J).then(e=>{let{data:n}=e;if(n){let e=n.map(e=>{let{nr:n,name:r,product_earned:t}=e;return{nr:n,name:r,earned:t}}),r={date:new Date(J),selledGoods:e},i=new Map(t);i.set(J,r),l(i)}}).then(()=>E(""))}))},[U,t,J]);let ee=s.useCallback(async e=>{E("Loading...");let n=new d.V("https://custom-tower-reader.cognitiveservices.azure.com/",new a.s5("36124cd3abf04be180ed61c350b297dd")),r=await n.beginAnalyzeDocument("prebuilt-receipt",e),{documents:l}=await r.pollUntilDone(),i=null==l?void 0:l.at(0);if(E(""),i){let{Items:e,Total:n,TransactionDate:r}=i.fields,l=[];if("array"===e.kind)for(let n of e.values){var s,c,o,u,h,j;l.push({nr:(null===(s=n.content)||void 0===s?void 0:s.slice(0,4))||"",name:(null===(c=n.properties.Description)||void 0===c?void 0:c.content)||"",earned:((null===(o=n.properties.TotalPrice)||void 0===o?void 0:o.kind)==="number"?null===(u=n.properties.TotalPrice)||void 0===u?void 0:u.value:Number(null===(j=n.properties.TotalPrice)||void 0===j?void 0:null===(h=j.content)||void 0===h?void 0:h.replace(",",".")))||0})}let d=r.content,a=new Date;if(d){let[e,n,r]=d.replace("r",".").split(".");a=new Date(+e+2e3,+n-1,+r)}let x={date:a,selledGoods:l};for(let[e]of t)(function(e,n){let r=new Date(e),t=new Date(n);return r.setHours(0,0,0,0),t.setHours(0,0,0,0),r.getTime()===t.getTime()})(new Date(e),a)&&(t.set(e,x),console.log("Nadpisano paragon!"));H(x)}},[t]),en=t.get(J);switch(U){case 0:e=(0,i.jsxs)("div",{children:[c&&(0,i.jsx)(o.$,{}),X&&(0,i.jsx)(u._,{items:X,columns:M,children:(0,i.jsxs)(h.S,{children:[(0,i.jsx)(j.m,{children:e=>{let{renderHeaderCell:n}=e;return(0,i.jsx)(x.p,{children:n()})}}),(0,i.jsx)(p.s,{children:e=>{let{item:n,rowId:r}=e;return(0,i.jsx)(j.m,{children:e=>{let{renderCell:r}=e;return(0,i.jsx)(v.a,{children:r(n)})}},r)}})]})}),(0,i.jsxs)("div",{children:[(0,i.jsx)(m.z,{onClick:()=>L(!A),children:A?"Anuluj":"Dodaj nowy"}),A&&(0,i.jsx)(m.z,{onClick:()=>{var e,n;if((null===(e=K.current)||void 0===e?void 0:e.value)&&(null===(n=B.current)||void 0===n?void 0:n.value)){E("Loading...");let e=B.current.value,n=K.current.value;K.current.value="",B.current.value="",q.from("product").insert({nr:e,name:n}).then(()=>{let r={nr:e,name:n};Y((null==X?void 0:X.concat(r))||[r]),console.log("Success")},()=>console.error("Failure")).then(()=>E("")),L(!1)}},children:"Dodaj"})]}),A&&(0,i.jsxs)("div",{children:[(0,i.jsx)(f.g,{label:(0,i.jsx)(g._,{children:"Nr"}),children:(0,i.jsx)(w.I,{ref:B})}),(0,i.jsx)(f.g,{label:(0,i.jsx)(g._,{children:"Nazwa"}),children:(0,i.jsx)(w.I,{ref:K})})]})]});break;case 1:e=(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{children:(0,i.jsx)(f.g,{label:(0,i.jsx)(g._,{children:"Data"}),children:(0,i.jsx)("input",{type:"date",value:J,onChange:e=>T(e.target.value)})})}),en?(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(u._,{items:null==en?void 0:en.selledGoods,columns:P,children:[(0,i.jsx)(h.S,{children:(0,i.jsx)(j.m,{children:e=>{let{renderHeaderCell:n}=e;return(0,i.jsx)(x.p,{children:n()})}})}),(0,i.jsx)(p.s,{children:e=>{let{item:n,rowId:r}=e;return(0,i.jsx)(j.m,{children:e=>{let{renderCell:r}=e;return(0,i.jsx)(v.a,{children:r(n)})}},r)}})]})}):(0,i.jsx)(I.x,{children:"Nie ma żadnego paragonu na dany dzień."})]});break;case 2:e=(0,i.jsxs)("div",{children:[c&&(0,i.jsx)(o.$,{}),(0,i.jsxs)(m.z,{onClick:()=>{var e;return null===(e=$.current)||void 0===e?void 0:e.click()},children:["Wybierz zdjęcie",(0,i.jsx)("input",{hidden:!0,type:"file",ref:$,onChange:e=>{var n;r((null===(n=e.target.files)||void 0===n?void 0:n.item(0))||void 0)}})]}),n&&(0,i.jsx)(m.z,{onClick:()=>r(void 0),children:"Usun zdjecie"}),n&&(0,i.jsx)(m.z,{onClick:()=>{ee(n),r(void 0)},children:"Analizuj"}),F&&(0,i.jsx)(m.z,{onClick:async()=>{await q.from("receipt").insert({date:G(F.date),daily_earned:0}),await q.from("selled_good").insert(F.selledGoods.map(e=>({date:G(F.date),goodnr:e.nr,amount:e.amount||0,product_earned:e.earned})))},children:"Zapisz"}),F&&(0,i.jsxs)(u._,{items:F.selledGoods,columns:P,children:[(0,i.jsx)(h.S,{children:(0,i.jsx)(j.m,{children:e=>{let{renderHeaderCell:n}=e;return(0,i.jsx)(x.p,{children:n()})}})}),(0,i.jsx)(p.s,{children:e=>{let{item:n,rowId:r}=e;return(0,i.jsx)(j.m,{children:e=>{let{renderCell:r}=e;return(0,i.jsx)(v.a,{children:r(n)})}},r)}})]})]});break;case 3:{let n="";if(Z){let[e,r]=function(e){let[n,r,t]=e.split("-");return[n,r,t]}(G(Z.date));n=e+"-"+r}e=(0,i.jsxs)("div",{children:[(0,i.jsx)(I.x,{children:"Generuj raport"}),(0,i.jsx)(f.g,{label:(0,i.jsx)(g._,{children:"Rok"}),children:(0,i.jsx)(w.I,{type:"month",ref:Q})}),(0,i.jsx)(m.z,{onClick:()=>{if(Q.current){let[e,n]=Q.current.value.split("-"),r=new Date(+e,+n-1),t=new Date(+e,+n);q.from("sold_good_product").select("*").gt("date",r.toISOString().slice(0,10)).lte("date",t.toISOString().slice(0,10)).then(e=>{let{data:n}=e;n&&V({total_earned:n.reduce((e,n)=>e+n.product_earned,0),date:r})})}},children:"Generuj"}),Z&&(0,i.jsxs)(b.i,{children:[(0,i.jsx)(z.x,{children:(0,i.jsxs)(C.S,{children:[(0,i.jsx)(S.x,{children:"Data"}),(0,i.jsx)(S.x,{children:"Zysk"})]})}),(0,i.jsx)(_.R,{children:(0,i.jsxs)(C.S,{children:[(0,i.jsx)(k.p,{children:n}),(0,i.jsx)(k.p,{children:Z.total_earned})]})})]})]})}}return(0,i.jsxs)(y.r,{theme:D.w,children:[(0,i.jsxs)(N.t,{selectedValue:U,onTabSelect:(e,n)=>W(n.value),children:[(0,i.jsx)(R.O,{value:2,children:"Nowy paragon"}),(0,i.jsx)(R.O,{value:1,children:"Paragony"}),(0,i.jsx)(R.O,{value:0,children:"Produkty"}),(0,i.jsx)(R.O,{value:3,children:"Raport"})]}),e]})}function G(e){let n=e.getFullYear(),r=e.getMonth()+1,t=e.getDate();return"".concat(n,"-").concat(r<10?"0"+r:r,"-").concat(t<10?"0"+t:t)}}},function(e){e.O(0,[407,455,874,720,221,929,319,610,111,487,744],function(){return e(e.s=2445)}),_N_E=e.O()}]);